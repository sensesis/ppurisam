events {}

http {
  upstream backend {
    server ppurisam_backend:8080;
  }

  upstream frontend {
    server ppurisam_frontend:3000;
  }

  server {
    listen 80;

    location /api/ {
      proxy_pass http://backend;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    location /open-api/ {
      proxy_pass http://backend;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    location / {
      proxy_pass http://frontend;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }


     location /ws/ {
       proxy_pass http://backend;                    # WebSocket 요청을 backend로 프록시
       proxy_http_version 1.1;                      # WebSocket 연결에 필요한 HTTP 1.1 사용
       proxy_set_header Upgrade $http_upgrade;      # WebSocket 프로토콜로 업그레이드
       proxy_set_header Connection "upgrade";       # 업그레이드 연결 지정
       proxy_set_header Host $host;                 # 클라이언트 요청의 Host 헤더 전달
       proxy_set_header X-Real-IP $remote_addr;     # 클라이언트의 실제 IP 전달
       proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
     }
  }
}

